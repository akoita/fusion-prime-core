# Foundry v1.4.0+ Configuration with Multichain Support
# Inherits from foundry-base.toml for shared settings

[profile.default]
extends = "./foundry-base.toml"

# Override fs_permissions to allow deployment artifact writes
# Note: Script uses vm.projectRoot() to construct absolute paths
fs_permissions = [
    { access = "read-write", path = "./deployments" }
]

# RPC endpoints (override with environment variables)
[rpc_endpoints]
sepolia = "${SEPOLIA_RPC_URL}"
amoy = "${AMOY_RPC_URL}"
polygon = "${POLYGON_RPC_URL}"
mainnet = "${MAINNET_RPC_URL}"
base_sepolia = "${BASE_SEPOLIA_RPC_URL}"
optimism_sepolia = "${OPTIMISM_SEPOLIA_RPC_URL}"
arbitrum_sepolia = "${ARBITRUM_SEPOLIA_RPC_URL}"

# Etherscan API keys for verification
[etherscan]
sepolia = { key = "${ETHERSCAN_API_KEY}", chain = 11155111, url = "https://api.etherscan.io/v2/api", chain_alias = "sepolia" }
mainnet = { key = "${ETHERSCAN_API_KEY}", chain = 1, url = "https://api.etherscan.io/v2/api", chain_alias = "mainnet" }
polygon = { key = "${ETHERSCAN_API_KEY}", chain = 137, url = "https://api.etherscan.io/v2/api", chain_alias = "polygon" }
amoy = { key = "${ETHERSCAN_API_KEY}", chain = 80002, url = "https://api.etherscan.io/v2/api", chain_alias = "amoy" }
base_sepolia = { key = "${ETHERSCAN_API_KEY}", chain = 84532, url = "https://api.etherscan.io/v2/api", chain_alias = "base-sepolia" }
optimism_sepolia = { key = "${ETHERSCAN_API_KEY}", chain = 11155420, url = "https://api.etherscan.io/v2/api", chain_alias = "optimism-sepolia" }
arbitrum_sepolia = { key = "${ETHERSCAN_API_KEY}", chain = 421614, url = "https://api.etherscan.io/v2/api", chain_alias = "arbitrum-sepolia" }

# CI Profile - faster execution for automated testing
[profile.ci]
extends = "./foundry-base.toml"
fuzz = { runs = 64 }
invariant = { runs = 32, depth = 10 }
verbosity = 3

# Local Development Profile
[profile.local]
extends = "./foundry-base.toml"
optimizer = false
verbosity = 4

# Production Profile - maximum optimization
[profile.production]
extends = "./foundry-base.toml"
optimizer = true
optimizer_runs = 10000
via_ir = true
verbosity = 1

# Coverage Profile
[profile.coverage]
extends = "./foundry-base.toml"
optimizer = false
extra_output = ["storageLayout"]

# Multi-module support
# Each module (escrow, cross-chain) can be built independently
# Root src/ is now empty - all contracts in domain modules
# Use remappings.txt for cross-module imports: escrow/, cross-chain/

# Cross-chain profile for deployment
[profile.cross-chain]
src = "cross-chain/src"
test = "cross-chain/test"
script = "cross-chain/script"
libs = ["lib"]
out = "out"
remappings = [
    "forge-std/=lib/forge-std/src/",
    "cross-chain/=cross-chain/src/"
]
