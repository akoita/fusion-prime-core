# Fusion Prime Dev Environment Configuration
# Copy this file to .env.dev and fill in your values
#
# This file is for DEV environment:
#   - Blockchain: Sepolia Testnet
#   - Services: GCP Cloud Run
#   - Database: Cloud SQL
#   - Development: Remote development and testing
#
# SETUP INSTRUCTIONS:
# 1. Copy this file: cp env.dev.example .env.dev
# 2. Fill in your actual values (see comments below)
# 3. Store secrets in GCP Secret Manager
# 4. Never commit .env.dev to Git (it's in .gitignore)

# ========================================
# Target Environment: DEV
# ========================================

# Blockchain Configuration (Sepolia)
# Using Simply Staking Spectrum (better rate limits for testing)
RPC_URL=https://sepolia.infura.io/v3/6c474ab8fd5f48b294e1a082adc2c826
ETH_RPC_URL=https://sepolia.infura.io/v3/6c474ab8fd5f48b294e1a082adc2c826




# Alternative RPC providers (commented out):
# Public RPC (free but unreliable):
# RPC_URL=https://rpc.sepolia.org
# ETH_RPC_URL=https://rpc.sepolia.org
# Alchemy (was hitting credit limits):
# RPC_URL=https://eth-sepolia.g.alchemy.com/v2/-esMtq9fCYUaKi80GPJqI
# ETH_RPC_URL=https://eth-sepolia.g.alchemy.com/v2/-esMtq9fCYUaKi80GPJqI
CHAIN_ID=11155111

POLYGON_RPC_URL=https://polygon-amoy.infura.io/v3/6c474ab8fd5f48b294e1a082adc2c826
POLYGON_CHAIN_ID=80002

# Smart Contracts (Deployed addresses)
ESCROW_FACTORY_ADDRESS=0x311E63dfcEfe7f2c202715ef0DF01CDA82f58914
ESCROW_FACTORY_ABI_PATH=contracts/abi/EscrowFactory.json

# Identity System (Deployed 2025-11-04)
IDENTITY_FACTORY_ADDRESS=0x59A97ebb44C7ebd23f5755A0C46F946d177319Ca
CLAIM_ISSUER_REGISTRY_ADDRESS=0xc88BCD77b2839fDf5499e91b3618eb7049F6CE21
IDENTITY_SERVICE_URL=https://identity-service-ggats6pubq-uc.a.run.app

# Deployer Private Key (NEVER commit this!)
DEPLOYER_PRIVATE_KEY=0x4e3e37bbc5eb0f15ea3793942aab858ef0e8025027a972234fdf3d2bbc3d12a8
PAYER_PRIVATE_KEY=0x4e3e37bbc5eb0f15ea3793942aab858ef0e8025027a972234fdf3d2bbc3d12a8

# Test Accounts
PAYEE_ADDRESS=0xE6Be859007336c4F108eE3B0EE6Ae0d7927CAbe2
PAYEE_PRIVATE_KEY=0x3439d60effd8590500e0803f8a1e75b40af9ceb415043fe9fcad2c141719ed3d
# Second approver for multi-approval tests (using payee since escrow only allows payer/payee/arbiter)
APPROVER2_PRIVATE_KEY=0x3439d60effd8590500e0803f8a1e75b40af9ceb415043fe9fcad2c141719ed3d
APPROVER2_ADDRESS=0xE6Be859007336c4F108eE3B0EE6Ae0d7927CAbe2

# Etherscan API Key for contract verification
ETHERSCAN_API_KEY=

# Backend Services (GCP Cloud Run)
# Updated 2025-10-28 during test validation
SETTLEMENT_SERVICE_URL=https://settlement-service-ggats6pubq-uc.a.run.app
RISK_ENGINE_SERVICE_URL=https://risk-engine-961424092563.us-central1.run.app
COMPLIANCE_SERVICE_URL=https://compliance-961424092563.us-central1.run.app
ALERT_NOTIFICATION_SERVICE_URL=https://alert-notification-service-961424092563.us-central1.run.app
RELAYER_SERVICE_URL=https://escrow-event-relayer-service-961424092563.us-central1.run.app

# Price Oracle Service (DEPLOYED 2025-10-27)
PRICE_ORACLE_SERVICE_URL=https://price-oracle-service-961424092563.us-central1.run.app
PRICE_ORACLE_URL=https://price-oracle-service-961424092563.us-central1.run.app

# Database Configuration (Cloud SQL)

# GCP Configuration
GCP_PROJECT=fusion-prime
GCP_REGION=us-central1
GOOGLE_APPLICATION_CREDENTIALS=/path/to/your/service-account-key.json

# Pub/Sub (GCP)
PUBSUB_PROJECT_ID=fusion-prime
PUBSUB_TOPIC=settlement.events.v1
PUBSUB_SUBSCRIPTION=settlement-events-consumer
SETTLEMENT_SUBSCRIPTION=settlement-events-consumer
RISK_SUBSCRIPTION=risk-events-consumer
ALERT_SUBSCRIPTION=alert-notification-service
PRICE_SUBSCRIPTION=risk-engine-prices-consumer

# Event Relayer Configuration
START_BLOCK=YOUR_DEPLOYMENT_BLOCK_NUMBER
POLL_INTERVAL=5

# Feature Flags
FUSION_PRIME_PUBSUB_TEST_MODE=false
LOG_LEVEL=INFO

# Environment Label
ENVIRONMENT=dev

# GCP Contract Registry (for remote environments)
CONTRACT_REGISTRY_BUCKET=fusion-prime-contract-registry
CONTRACT_REGISTRY_CHAIN_ID=11155111
ESCROW_FACTORY_ABI_URL=gs://fusion-prime-contract-registry/contracts/dev/11155111/EscrowFactory.json
ESCROW_ABI_URL=gs://fusion-prime-contract-registry/contracts/dev/11155111/Escrow.json
CONTRACT_ADDRESS=0x311E63dfcEfe7f2c202715ef0DF01CDA82f58914
START_BLOCK=9495824

# Relayer Performance Configuration
# Optimized for Infura subscription (15M credits/day, 4K credits/second)

# Process more blocks per batch with improved throughput (default: 10)
RELAYER_BATCH_SIZE=100

# Poll every 3 seconds for near real-time event processing (default: 12 seconds)
# Infura subscription supports 4K credits/second, allowing aggressive polling
RELAYER_POLL_INTERVAL=3

# Save progress every 100 blocks (default: 100 blocks)
RELAYER_CHECKPOINT_INTERVAL=100

# Note: Previous conservative settings (POLL_INTERVAL=15, BATCH_SIZE=20) were for free RPC
# New Infura subscription allows for much more aggressive event polling

# Database Configuration - Updated 2025-10-27 with new standardized naming
# Settlement Service Database
SETTLEMENT_DATABASE_URL="postgresql+asyncpg://settlement_user:JKjmazz<h?d2p]09p&)$]_zvs8Ic(P}!@/settlement_db?host=/cloudsql/fusion-prime:us-central1:fp-settlement-db-590d836a"

# Risk Engine Service Database
# PRODUCTION/CLOUD RUN: Use Unix socket (default)
#RISK_DATABASE_URL="postgresql+asyncpg://risk_user:X>AA(P1{A=mn[TemRyBX]jI!!{b3JcV<@/risk_db?host=/cloudsql/fusion-prime:us-central1:fp-risk-db-1d929830"

# LOCAL TESTING: Use Cloud SQL Proxy on localhost:5433 (for direct database validation)
# To enable: 1) Start proxy: cloud-sql-proxy fusion-prime:us-central1:fp-risk-db-1d929830 --port 5433
#            2) Uncomment line below and comment line above
RISK_DATABASE_URL="postgresql+asyncpg://risk_user:X>AA(P1{A=mn[TemRyBX]jI!!{b3JcV<@localhost:5433/risk_db"

# Compliance Service Database
COMPLIANCE_DATABASE_URL="postgresql+asyncpg://compliance_user:<qZ!N62(VIp7J:wNXrNerrjKom*@*[wW@/compliance_db?host=/cloudsql/fusion-prime:us-central1:fp-compliance-db-0b9f2040"

# Price Oracle Service Database (NEW)
PRICE_ORACLE_DATABASE_URL="postgresql+asyncpg://price_oracle_user:vEBOuKMx<N)a4VI$w1Tq]6#cj_SW=Uhc@/price_oracle_db?host=/cloudsql/fusion-prime:us-central1:fp-priceoracle-db-683fed10"

# Alert Notification Service Database (NEW)
ALERT_DATABASE_URL="postgresql+asyncpg://alert_user:606HEa&Yj_>s_lo0SLP2zH0RbpTx2(3]@/alert_db?host=/cloudsql/fusion-prime:us-central1:fp-alert-db-e0b47f9a"

# Legacy DATABASE_URL (points to settlement for backward compatibility)
DATABASE_URL="postgresql+asyncpg://settlement_user:JKjmazz<h?d2p]09p&)$]_zvs8Ic(P}!@/settlement_db?host=/cloudsql/fusion-prime:us-central1:fp-settlement-db-590d836a"
